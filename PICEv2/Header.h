#pragma once
#include <Windows.h>


#define NtCurrentProcess() ((HANDLE)-1)
#define ProcessInstrumentationCallback (PROCESS_INFORMATION_CLASS)0x28 

const wchar_t* NtSystemCalls[] = { L"NtAccessCheck", L"NtWorkerFactoryWorkerReady", L"NtAcceptConnectPort", L"NtMapUserPhysicalPagesScatter", L"NtWaitForSingleObject", L"NtCallbackReturn", L"NtReadFile", L"NtDeviceIoControlFile", L"NtWriteFile", L"NtRemoveIoCompletion", L"NtReleaseSemaphore", L"NtReplyWaitReceivePort", L"NtReplyPort", L"NtSetInformationThread", L"NtSetEvent", L"NtClose", L"NtQueryObject", L"NtQueryInformationFile", L"NtOpenKey", L"NtEnumerateValueKey", L"NtFindAtom", L"NtQueryDefaultLocale", L"NtQueryKey", L"NtQueryValueKey", L"NtAllocateVirtualMemory", L"NtQueryInformationProcess", L"NtWaitForMultipleObjects32", L"NtWriteFileGather", L"NtSetInformationProcess", L"NtCreateKey", L"NtFreeVirtualMemory", L"NtImpersonateClientOfPort", L"NtReleaseMutant", L"NtQueryInformationToken", L"NtRequestWaitReplyPort", L"NtQueryVirtualMemory", L"NtOpenThreadToken", L"NtQueryInformationThread", L"NtOpenProcess", L"NtSetInformationFile", L"NtMapViewOfSection", L"NtAccessCheckAndAuditAlarm", L"NtUnmapViewOfSection", L"NtReplyWaitReceivePortEx", L"NtTerminateProcess", L"NtSetEventBoostPriority", L"NtReadFileScatter", L"NtOpenThreadTokenEx", L"NtOpenProcessTokenEx", L"NtQueryPerformanceCounter", L"NtEnumerateKey", L"NtOpenFile", L"NtDelayExecution", L"NtQueryDirectoryFile", L"NtQuerySystemInformation", L"NtOpenSection", L"NtQueryTimer", L"NtFsControlFile", L"NtWriteVirtualMemory", L"NtCloseObjectAuditAlarm", L"NtDuplicateObject", L"NtQueryAttributesFile", L"NtClearEvent", L"NtReadVirtualMemory", L"NtOpenEvent", L"NtAdjustPrivilegesToken", L"NtDuplicateToken", L"NtContinue", L"NtQueryDefaultUILanguage", L"NtQueueApcThread", L"NtYieldExecution", L"NtAddAtom", L"NtCreateEvent", L"NtQueryVolumeInformationFile", L"NtCreateSection", L"NtFlushBuffersFile", L"NtApphelpCacheControl", L"NtCreateProcessEx", L"NtCreateThread", L"NtIsProcessInJob", L"NtProtectVirtualMemory", L"NtQuerySection", L"NtResumeThread", L"NtTerminateThread", L"NtReadRequestData", L"NtCreateFile", L"NtQueryEvent", L"NtWriteRequestData", L"NtOpenDirectoryObject", L"NtAccessCheckByTypeAndAuditAlarm", L"NtQuerySystemTime", L"NtWaitForMultipleObjects", L"NtSetInformationObject", L"NtCancelIoFile", L"NtTraceEvent", L"NtPowerInformation", L"NtSetValueKey", L"NtCancelTimer", L"NtSetTimer", L"NtAccessCheckByType", L"NtAccessCheckByTypeResultList", L"NtAccessCheckByTypeResultListAndAuditAlarm", L"NtAccessCheckByTypeResultListAndAuditAlarmByHandle", L"NtAcquireCrossVmMutant", L"NtAcquireProcessActivityReference", L"NtAddAtomEx", L"NtAddBootEntry", L"NtAddDriverEntry", L"NtAdjustGroupsToken", L"NtAdjustTokenClaimsAndDeviceGroups", L"NtAlertResumeThread", L"NtAlertThread", L"NtAlertThreadByThreadId", L"NtAllocateLocallyUniqueId", L"NtAllocateReserveObject", L"NtAllocateUserPhysicalPages", L"NtAllocateUserPhysicalPagesEx", L"NtAllocateUuids", L"NtAllocateVirtualMemoryEx", L"NtAlpcAcceptConnectPort", L"NtAlpcCancelMessage", L"NtAlpcConnectPort", L"NtAlpcConnectPortEx", L"NtAlpcCreatePort", L"NtAlpcCreatePortSection", L"NtAlpcCreateResourceReserve", L"NtAlpcCreateSectionView", L"NtAlpcCreateSecurityContext", L"NtAlpcDeletePortSection", L"NtAlpcDeleteResourceReserve", L"NtAlpcDeleteSectionView", L"NtAlpcDeleteSecurityContext", L"NtAlpcDisconnectPort", L"NtAlpcImpersonateClientContainerOfPort", L"NtAlpcImpersonateClientOfPort", L"NtAlpcOpenSenderProcess", L"NtAlpcOpenSenderThread", L"NtAlpcQueryInformation", L"NtAlpcQueryInformationMessage", L"NtAlpcRevokeSecurityContext", L"NtAlpcSendWaitReceivePort", L"NtAlpcSetInformation", L"NtAreMappedFilesTheSame", L"NtAssignProcessToJobObject", L"NtAssociateWaitCompletionPacket", L"NtCallEnclave", L"NtCancelIoFileEx", L"NtCancelSynchronousIoFile", L"NtCancelTimer2", L"NtCancelWaitCompletionPacket", L"NtCommitComplete", L"NtCommitEnlistment", L"NtCommitRegistryTransaction", L"NtCommitTransaction", L"NtCompactKeys", L"NtCompareObjects", L"NtCompareSigningLevels", L"NtCompareTokens", L"NtCompleteConnectPort", L"NtCompressKey", L"NtConnectPort", L"NtContinueEx", L"NtConvertBetweenAuxiliaryCounterAndPerformanceCounter", L"NtCreateCrossVmEvent", L"NtCreateCrossVmMutant", L"NtCreateDebugObject", L"NtCreateDirectoryObject", L"NtCreateDirectoryObjectEx", L"NtCreateEnclave", L"NtCreateEnlistment", L"NtCreateEventPair", L"NtCreateIRTimer", L"NtCreateIoCompletion", L"NtCreateJobObject", L"NtCreateJobSet", L"NtCreateKeyTransacted", L"NtCreateKeyedEvent", L"NtCreateLowBoxToken", L"NtCreateMailslotFile", L"NtCreateMutant", L"NtCreateNamedPipeFile", L"NtCreatePagingFile", L"NtCreatePartition", L"NtCreatePort", L"NtCreatePrivateNamespace", L"NtCreateProcess", L"NtCreateProfile", L"NtCreateProfileEx", L"NtCreateRegistryTransaction", L"NtCreateResourceManager", L"NtCreateSectionEx", L"NtCreateSemaphore", L"NtCreateSymbolicLinkObject", L"NtCreateThreadEx", L"NtCreateTimer", L"NtCreateTimer2", L"NtCreateToken", L"NtCreateTokenEx", L"NtCreateTransaction", L"NtCreateTransactionManager", L"NtCreateUserProcess", L"NtCreateWaitCompletionPacket", L"NtCreateWaitablePort", L"NtCreateWnfStateName", L"NtCreateWorkerFactory", L"NtDebugActiveProcess", L"NtDebugContinue", L"NtDeleteAtom", L"NtDeleteBootEntry", L"NtDeleteDriverEntry", L"NtDeleteFile", L"NtDeleteKey", L"NtDeleteObjectAuditAlarm", L"NtDeletePrivateNamespace", L"NtDeleteValueKey", L"NtDeleteWnfStateData", L"NtDeleteWnfStateName", L"NtDirectGraphicsCall", L"NtDisableLastKnownGood", L"NtDisplayString", L"NtDrawText", L"NtEnableLastKnownGood", L"NtEnumerateBootEntries", L"NtEnumerateDriverEntries", L"NtEnumerateSystemEnvironmentValuesEx", L"NtEnumerateTransactionObject", L"NtExtendSection", L"NtFilterBootOption", L"NtFilterToken", L"NtFilterTokenEx", L"NtFlushBuffersFileEx", L"NtFlushInstallUILanguage", L"NtFlushInstructionCache", L"NtFlushKey", L"NtFlushProcessWriteBuffers", L"NtFlushVirtualMemory", L"NtFlushWriteBuffer", L"NtFreeUserPhysicalPages", L"NtFreezeRegistry", L"NtFreezeTransactions", L"NtGetCachedSigningLevel", L"NtGetCompleteWnfStateSubscription", L"NtGetContextThread", L"NtGetCurrentProcessorNumber", L"NtGetCurrentProcessorNumberEx", L"NtGetDevicePowerState", L"NtGetMUIRegistryInfo", L"NtGetNextProcess", L"NtGetNextThread", L"NtGetNlsSectionPtr", L"NtGetNotificationResourceManager", L"NtGetWriteWatch", L"NtImpersonateAnonymousToken", L"NtImpersonateThread", L"NtInitializeEnclave", L"NtInitializeNlsFiles", L"NtInitializeRegistry", L"NtInitiatePowerAction", L"NtIsSystemResumeAutomatic", L"NtIsUILanguageComitted", L"NtListenPort", L"NtLoadDriver", L"NtLoadEnclaveData", L"NtLoadKey", L"NtLoadKey2", L"NtLoadKeyEx", L"NtLockFile", L"NtLockProductActivationKeys", L"NtLockRegistryKey", L"NtLockVirtualMemory", L"NtMakePermanentObject", L"NtMakeTemporaryObject", L"NtManageHotPatch", L"NtManagePartition", L"NtMapCMFModule", L"NtMapUserPhysicalPages", L"NtMapViewOfSectionEx", L"NtModifyBootEntry", L"NtModifyDriverEntry", L"NtNotifyChangeDirectoryFile", L"NtNotifyChangeDirectoryFileEx", L"NtNotifyChangeKey", L"NtNotifyChangeMultipleKeys", L"NtNotifyChangeSession", L"NtOpenEnlistment", L"NtOpenEventPair", L"NtOpenIoCompletion", L"NtOpenJobObject", L"NtOpenKeyEx", L"NtOpenKeyTransacted", L"NtOpenKeyTransactedEx", L"NtOpenKeyedEvent", L"NtOpenMutant", L"NtOpenObjectAuditAlarm", L"NtOpenPartition", L"NtOpenPrivateNamespace", L"NtOpenProcessToken", L"NtOpenRegistryTransaction", L"NtOpenResourceManager", L"NtOpenSemaphore", L"NtOpenSession", L"NtOpenSymbolicLinkObject", L"NtOpenThread", L"NtOpenTimer", L"NtOpenTransaction", L"NtOpenTransactionManager", L"NtPlugPlayControl", L"NtPrePrepareComplete", L"NtPrePrepareEnlistment", L"NtPrepareComplete", L"NtPrepareEnlistment", L"NtPrivilegeCheck", L"NtPrivilegeObjectAuditAlarm", L"NtPrivilegedServiceAuditAlarm", L"NtPropagationComplete", L"NtPropagationFailed", L"NtPssCaptureVaSpaceBulk", L"NtPulseEvent", L"NtQueryAuxiliaryCounterFrequency", L"NtQueryBootEntryOrder", L"NtQueryBootOptions", L"NtQueryDebugFilterState", L"NtQueryDirectoryFileEx", L"NtQueryDirectoryObject", L"NtQueryDriverEntryOrder", L"NtQueryEaFile", L"NtQueryFullAttributesFile", L"NtQueryInformationAtom", L"NtQueryInformationByName", L"NtQueryInformationEnlistment", L"NtQueryInformationJobObject", L"NtQueryInformationPort", L"NtQueryInformationResourceManager", L"NtQueryInformationTransaction", L"NtQueryInformationTransactionManager", L"NtQueryInformationWorkerFactory", L"NtQueryInstallUILanguage", L"NtQueryIntervalProfile", L"NtQueryIoCompletion", L"NtQueryLicenseValue", L"NtQueryMultipleValueKey", L"NtQueryMutant", L"NtQueryOpenSubKeys", L"NtQueryOpenSubKeysEx", L"NtQueryPortInformationProcess", L"NtQueryQuotaInformationFile", L"NtQuerySecurityAttributesToken", L"NtQuerySecurityObject", L"NtQuerySecurityPolicy", L"NtQuerySemaphore", L"NtQuerySymbolicLinkObject", L"NtQuerySystemEnvironmentValue", L"NtQuerySystemEnvironmentValueEx", L"NtQuerySystemInformationEx", L"NtQueryTimerResolution", L"NtQueryWnfStateData", L"NtQueryWnfStateNameInformation", L"NtQueueApcThreadEx", L"NtRaiseException", L"NtRaiseHardError", L"NtReadOnlyEnlistment", L"NtRecoverEnlistment", L"NtRecoverResourceManager", L"NtRecoverTransactionManager", L"NtRegisterProtocolAddressInformation", L"NtRegisterThreadTerminatePort", L"NtReleaseKeyedEvent", L"NtReleaseWorkerFactoryWorker", L"NtRemoveIoCompletionEx", L"NtRemoveProcessDebug", L"NtRenameKey", L"NtRenameTransactionManager", L"NtReplaceKey", L"NtReplacePartitionUnit", L"NtReplyWaitReplyPort", L"NtRequestPort", L"NtResetEvent", L"NtResetWriteWatch", L"NtRestoreKey", L"NtResumeProcess", L"NtRevertContainerImpersonation", L"NtRollbackComplete", L"NtRollbackEnlistment", L"NtRollbackRegistryTransaction", L"NtRollbackTransaction", L"NtRollforwardTransactionManager", L"NtSaveKey", L"NtSaveKeyEx", L"NtSaveMergedKeys", L"NtSecureConnectPort", L"NtSerializeBoot", L"NtSetBootEntryOrder", L"NtSetBootOptions", L"NtSetCachedSigningLevel", L"NtSetCachedSigningLevel2", L"NtSetContextThread", L"NtSetDebugFilterState", L"NtSetDefaultHardErrorPort", L"NtSetDefaultLocale", L"NtSetDefaultUILanguage", L"NtSetDriverEntryOrder", L"NtSetEaFile", L"NtSetHighEventPair", L"NtSetHighWaitLowEventPair", L"NtSetIRTimer", L"NtSetInformationDebugObject", L"NtSetInformationEnlistment", L"NtSetInformationJobObject", L"NtSetInformationKey", L"NtSetInformationResourceManager", L"NtSetInformationSymbolicLink", L"NtSetInformationToken", L"NtSetInformationTransaction", L"NtSetInformationTransactionManager", L"NtSetInformationVirtualMemory", L"NtSetInformationWorkerFactory", L"NtSetIntervalProfile", L"NtSetIoCompletion", L"NtSetIoCompletionEx", L"NtSetLdtEntries", L"NtSetLowEventPair", L"NtSetLowWaitHighEventPair", L"NtSetQuotaInformationFile", L"NtSetSecurityObject", L"NtSetSystemEnvironmentValue", L"NtSetSystemEnvironmentValueEx", L"NtSetSystemInformation", L"NtSetSystemPowerState", L"NtSetSystemTime", L"NtSetThreadExecutionState", L"NtSetTimer2", L"NtSetTimerEx", L"NtSetTimerResolution", L"NtSetUuidSeed", L"NtSetVolumeInformationFile", L"NtSetWnfProcessNotificationEvent", L"NtShutdownSystem", L"NtShutdownWorkerFactory", L"NtSignalAndWaitForSingleObject", L"NtSinglePhaseReject", L"NtStartProfile", L"NtStopProfile", L"NtSubscribeWnfStateChange", L"NtSuspendProcess", L"NtSuspendThread", L"NtSystemDebugControl", L"NtTerminateEnclave", L"NtTerminateJobObject", L"NtTestAlert", L"NtThawRegistry", L"NtThawTransactions", L"NtTraceControl", L"NtTranslateFilePath", L"NtUmsThreadYield", L"NtUnloadDriver", L"NtUnloadKey", L"NtUnloadKey2", L"NtUnloadKeyEx", L"NtUnlockFile", L"NtUnlockVirtualMemory", L"NtUnmapViewOfSectionEx", L"NtUnsubscribeWnfStateChange", L"NtUpdateWnfStateData", L"NtVdmControl", L"NtWaitForAlertByThreadId", L"NtWaitForDebugEvent", L"NtWaitForKeyedEvent", L"NtWaitForWorkViaWorkerFactory", L"NtWaitHighEventPair", L"NtWaitLowEventPair", L"NtLoadKey3" };

typedef void(*CallbackFunction)();

typedef NTSTATUS(NTAPI* pNtSetInformationProcess)(
	HANDLE ProcessHandle,
	PROCESS_INFORMATION_CLASS ProcessInformationClass,
	PVOID ProcessInformation,
	ULONG ProcessInformationLength
	);

typedef struct _PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION
{
	ULONG Version;
	ULONG Reserved;
	CallbackFunction Callback; //Our hooking function
} PROCESS_INSTRUMENTATION_CALLBACK_INFORMATION, * PPROCESS_INSTRUMENTATION_CALLBACK_INFORMATION;

// Below taken from syswhispers2 with modifications
#define RVA2VA(Type, DllBase, Rva) (Type)((ULONG_PTR) DllBase + Rva)
#define ROL8(v) (v << 8 | v >> 24)
#define ROR8(v) (v >> 8 | v << 24)
#define ROX8(v) ((0xDEADBEEF % 2) ? ROL8(v) : ROR8(v))



typedef struct SYSCALL_ENTRY
{
	DWORD HashedName;	//Will be stored as a hash
	DWORD RVAAddress;	//Stored as RVA
} SYSCALL_ENTRY, * PSYSCALL_ENTRY;

typedef struct SYSCALL_LIST
{
	DWORD Count;
	SYSCALL_ENTRY Entries[500]; //We should never have more than 400ish
} SYSCALL_LIST, * PSYSCALL_LIST;